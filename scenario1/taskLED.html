<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scenario 1 ‚Äì Task 1 (LED)</title>
  <link rel="stylesheet" href="../style.css">
</head>

<body>
  <div class="container">
    <h2>Scenario 1 (Awareness Test)</h2>
    <p><strong>Task 1 / 4 : LED (‡πÅ‡∏™‡∏á)</strong></p>
    <p><strong>Trial <span id="trialNum">1</span> / 20</strong></p>
    <hr>

    <p class="question">‡∏à‡∏≤‡∏Å‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≤‡∏ô‡πÄ‡∏´‡πá‡∏ô ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà ‡πÅ‡∏•‡∏∞‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏™‡∏†‡∏≤‡∏û‡πÉ‡∏î?</p>
    <p class="note"> üî∏ ‡∏ó‡∏∏‡∏Å Task ‡∏à‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á <strong>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠</strong> ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö  
  ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏™‡∏∑‡πà‡∏≠‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏Ñ‡∏£‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏∂‡∏á‡∏Ñ‡πà‡∏≠‡∏¢‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</p>

    <video id="stimVideo" width="250" autoplay muted playsinline></video>

    <div class="btn-area">
      <button class="answer" data-choice="1">‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡∏∞‡∏õ‡∏Å‡∏ï‡∏¥</button>
      <button class="answer" data-choice="2">‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏ï‡πà‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ (‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢)</button>
      <button class="answer" data-choice="3">‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏ï‡πà‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ (‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á)</button>
      <button class="answer" data-choice="4">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</button>
    </div>
  </div>

  <script>
    const pid = localStorage.getItem("pid");
    const taskIndex = 1;
    const totalTrials = 20;
    const stimuli = ["green", "yellow", "red", "off"];
    const folder = "./s1LED/";
    let currentTrial = 0, startTime, data = [];

    const video = document.getElementById("stimVideo");
    const trialNum = document.getElementById("trialNum");
    const btns = document.querySelectorAll(".answer");

    startTrial();
    function startTrial() {
      if (currentTrial >= totalTrials) { showConfidence(true); return; }
      const stim = stimuli[Math.floor(Math.random()*4)];
      video.src = `${folder}${stim}.mp4`;
      trialNum.textContent = currentTrial+1;
      startTime = performance.now();
      btns.forEach(b => b.disabled=false);
    }

    btns.forEach(b=>{
      b.addEventListener("click",()=>{
        const rt = ((performance.now()-startTime)/1000).toFixed(2);
        const resp = +b.dataset.choice;
        const stim = video.src.split("/").pop().replace(".mp4","");
        const correct = {green:1,yellow:2,red:3,off:4}[stim];
        data.push({pid,task:"LED",trial:currentTrial+1,stim,resp,correct,isCorrect:resp===correct,rt});
        currentTrial++;
        if(currentTrial%10===0||currentTrial===totalTrials) showConfidence(currentTrial===totalTrials);
        else setTimeout(startTrial,500);
      });
    });

    function showConfidence(end=false){
      const conf = prompt("‡∏Ñ‡∏∏‡∏ì‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡πÅ‡∏Ñ‡πà‡πÑ‡∏´‡∏ô‡∏ß‡πà‡∏≤‡∏£‡∏±‡∏ö‡∏£‡∏π‡πâ‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á?\n(1 = ‡πÑ‡∏°‡πà‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡πÄ‡∏•‡∏¢ ‚Äì 5 = ‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î)","");
      data.push({pid,task:"LED",confidence:+conf||0});
      if(end){
        alert("‡∏à‡∏ö Task 1/4 ‡πÅ‡∏•‡πâ‡∏ß ‚Üí ‡∏ó‡∏≥ Task ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ");
        localStorage.setItem("scenario1_data",JSON.stringify(data));
        window.location.href="taskSound.html";
      }else{
        alert("‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡πà‡∏∞ ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠");
        startTrial();
      }
    }
  </script>
</body>
</html>
