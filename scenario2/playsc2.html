<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Scenario 2 ‚Äì Easy Interface Test</title>
  <style>
    body {
      font-family: "Sarabun", sans-serif;
      background: #f7f7f7;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
    }

    .card {
      background: white;
      padding: 30px 40px;
      border-radius: 16px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
      text-align: center;
      width: 420px;
    }

    h2 {
      margin-top: 0;
      margin-bottom: 10px;
    }

    hr {
      margin: 15px 0;
      border: none;
      border-top: 1px solid #ccc;
    }

    img {
      width: 320px;
      border-radius: 10px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.15);
      margin: 15px 0;
      cursor: pointer;
    }

    .status {
      font-size: 0.95em;
      color: #333;
      margin-top: 8px;
    }
  </style>
</head>

<body>
  <div class="card">
    <h2>Scenario 2 (Easy Interface Test)</h2>
    <hr>
    <p id="progress">‡∏†‡∏≤‡∏û 1 / 4</p>

    <img id="testImage" src="" alt="interface" />

    <div class="status">
      ‚è± ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏´‡∏•‡∏∑‡∏≠: <span id="timer">30</span> ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ<br>
      ‚úÖ ‡∏ñ‡∏π‡∏Å: <span id="correct">0</span> | ‚ùå ‡∏ú‡∏¥‡∏î: <span id="wrong">0</span>
    </div>
  </div>

  <script>
    // üì∏ ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏†‡∏≤‡∏û
    const images = ["bicon.png", "bictext.png", "onlybotton.png", "original.png"];

    // üéØ ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏° (x,y,w,h)
    const buttonAreas = {
      "bicon.png":      { x: 0.10, y: 0.08, w: 0.10, h: 0.10 },
      "bictext.png":    { x: 0.10, y: 0.08, w: 0.12, h: 0.12 },
      "onlybotton.png": { x: 0.10, y: 0.09, w: 0.09, h: 0.09 },
      "original.png":   null
    };

    // üß© Latin Square 4√ó4
    const latinOrders = [
      [0, 1, 2, 3],
      [1, 2, 3, 0],
      [2, 3, 0, 1],
      [3, 0, 1, 2]
    ];

    // üÜî ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å localStorage
    const pid = localStorage.getItem("pid") || "Unknown";
    const group = localStorage.getItem("group") || "N/A";
    const orderIndex = (parseInt(pid.replace(/\D/g, "")) - 1) % 4;
    const trialOrder = latinOrders[orderIndex].map(i => images[i]);

    // üî¢ ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏´‡∏•‡∏±‡∏Å
    let current = 0, correct = 0, wrong = 0, timeLeft = 30, timer;

    const imgEl = document.getElementById("testImage");
    const timerEl = document.getElementById("timer");
    const correctEl = document.getElementById("correct");
    const wrongEl = document.getElementById("wrong");
    const progressEl = document.getElementById("progress");

    // üì• ‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö
    function loadImage() {
      imgEl.src = "picscenario2/" + trialOrder[current]; // ‚úÖ ‡πÅ‡∏Å‡πâ path ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å
      progressEl.textContent = `‡∏†‡∏≤‡∏û ${current + 1} / ${trialOrder.length}`;
      timeLeft = 30;
      timerEl.textContent = timeLeft;
      clearInterval(timer);

      timer = setInterval(() => {
        timeLeft--;
        timerEl.textContent = timeLeft;
        if (timeLeft <= 0) askConfidence();
      }, 1000);
    }

    // üëÜ ‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ö‡∏ô‡∏†‡∏≤‡∏û
    imgEl.addEventListener("click", e => {
      const rect = imgEl.getBoundingClientRect();
      const x = (e.clientX - rect.left) / rect.width;
      const y = (e.clientY - rect.top) / rect.height;
      const imgName = trialOrder[current];
      const area = buttonAreas[imgName];

      if (area && x >= area.x && x <= area.x + area.w &&
          y >= area.y && y <= area.y + area.h) {
        correct++;
      } else {
        wrong++;
      }
      correctEl.textContent = correct;
      wrongEl.textContent = wrong;
    });

    // üìä ‡∏ñ‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏´‡∏•‡∏±‡∏á‡∏†‡∏≤‡∏û‡∏à‡∏ö
    function askConfidence() {
      clearInterval(timer);
      alert("‚è∞ ‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡πâ‡∏ß! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì");
      const conf = prompt("‡∏Ñ‡∏∏‡∏ì‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡πÅ‡∏Ñ‡πà‡πÑ‡∏´‡∏ô‡∏ß‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á?\n( [1] ‡πÑ‡∏°‡πà‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡πÄ‡∏•‡∏¢ ‚Äì [5] ‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î )");
      if (conf) localStorage.setItem(`conf_${trialOrder[current]}`, conf);
      nextImage();
    }

    // ‚è≠Ô∏è ‡πÑ‡∏õ‡∏†‡∏≤‡∏û‡∏ñ‡∏±‡∏î‡πÑ‡∏õ / ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•
    function nextImage() {
      current++;
      if (current < trialOrder.length) {
        alert("‚û°Ô∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏õ‡∏†‡∏≤‡∏û‡∏ñ‡∏±‡∏î‡πÑ‡∏õ...");
        loadImage();
      } else {
        clearInterval(timer);
        const result = {
          scenario: "Scenario 2",
          pid,
          group,
          correct,
          wrong,
          confidence: trialOrder.map(img => ({
            image: img,
            score: localStorage.getItem('conf_' + img) || '-'
          }))
        };
        localStorage.setItem("result_scenario2", JSON.stringify(result));
        // üßπ ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤ confidence ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡∏£‡∏≤‡∏¢‡∏†‡∏≤‡∏û
        trialOrder.forEach(img => localStorage.removeItem('conf_' + img));
        window.location.href = "../summary.html";
      }
    }

    // ‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
    loadImage();
  </script>
</body>
</html>
